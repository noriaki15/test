<!DOCTYPE html>
<html>
<head>
    <title>AR GPS Location Based</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

    <script>
        AFRAME.registerComponent('distance-check', {
            init: function() {
                this.target = {
                    lat: 33.8883,
                    lon: 130.7113
                };
                
                this.distanceText = document.querySelector('#distanceText');
                this.updateDistance = this.updateDistance.bind(this);
                
                if ("geolocation" in navigator) {
                    navigator.geolocation.watchPosition(this.updateDistance);
                }
            },

            updateDistance: function(position) {
                const currentLat = position.coords.latitude;
                const currentLon = position.coords.longitude;
                
                const R = 6371;
                const dLat = this.toRad(this.target.lat - currentLat);
                const dLon = this.toRad(this.target.lon - currentLon);
                const lat1 = this.toRad(currentLat);
                const lat2 = this.toRad(this.target.lat);

                const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                        Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                const distance = R * c;

                let distanceDisplay;
                if (distance >= 1) {
                    distanceDisplay = `${distance.toFixed(2)} km`;
                } else {
                    distanceDisplay = `${(distance * 1000).toFixed(0)} m`;
                }

                this.distanceText.setAttribute('value', `距離: ${distanceDisplay}`);
            },

            toRad: function(degree) {
                return degree * Math.PI / 180;
            }
        });
    </script>
</head>

<body style="margin: 0; overflow: hidden;">
    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; videoTexture: true;">

        <a-camera gps-camera rotation-reader>
        </a-camera>

        <a-box
            gps-entity-place="latitude: 33.8883; longitude: 130.7113"
            position="0 0 0"
            scale="1 1 1"
            material="color: red"
            distance-check>
        </a-box>

        <a-text
            id="distanceText"
            value="Loading..."
            scale="1 1 1"
            align="center"
            position="0 1.5 0"
            rotation="0 0 0"
            gps-entity-place="latitude: 33.8883; longitude: 130.7113">
        </a-text>

    </a-scene>
</body>
</html>
