<!DOCTYPE html>
<html>
<head>
    <title>WebAR Persistent Marker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
        AFRAME.registerComponent('marker-handler', {
            init: function () {
                this.markerFound = false;
                this.position = null;
                
                // 마커가 발견되었을 때
                this.el.addEventListener('markerFound', () => {
                    if (!this.markerFound) {
                        // 처음 마커가 발견되었을 때만 위치를 저장
                        const modelEl = document.querySelector('#persistent-object');
                        this.position = modelEl.getAttribute('position');
                        this.markerFound = true;
                        
                        // 월드 좌표로 오브젝트 생성
                        const worldModel = document.createElement('a-box');
                        worldModel.setAttribute('position', this.position);
                        worldModel.setAttribute('color', 'red');
                        worldModel.setAttribute('scale', '0.5 0.5 0.5');
                        document.querySelector('a-scene').appendChild(worldModel);
                        
                        // 마커에 있는 원본 모델은 숨김
                        modelEl.setAttribute('visible', 'false');
                    }
                });
            }
        });
    </script>
</head>
<body>
    <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
        <!-- 마커 정의 -->
        <a-marker preset="hiro" marker-handler>
            <!-- 마커 위에 표시될 초기 오브젝트 -->
            <a-box id="persistent-object"
                   position="0 0.5 0"
                   color="red"
                   scale="0.5 0.5 0.5">
            </a-box>
        </a-marker>
        
        <!-- 카메라 -->
        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>
